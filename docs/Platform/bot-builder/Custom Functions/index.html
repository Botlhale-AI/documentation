<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Botlhale NLP Toolkit Documentation Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Botlhale NLP Toolkit Documentation Blog Atom Feed"><title data-react-helmet="true">Custom Functions | Botlhale NLP Toolkit Documentation</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://docs.botlhale.xyz/docs/Platform/bot-builder/Custom Functions"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Custom Functions | Botlhale NLP Toolkit Documentation"><meta data-react-helmet="true" name="description" content="Introducing our state-of-the-art bot builder platform, designed to empower you with the capabilities of natural language processing (NLP) and enhance your conversational AI solutions. As part of our commitment to delivering a truly tailored experience, we are delighted to offer a range of custom functions (some preset/predefined, some customizable) that will revolutionize the way your bots interact with your end users and/or customer. Custom functions enable you to create personalized and dynamic conversational flows, allowing your bots to understand user intents, extract key information, and generate intelligent responses. With our platform, you can effortlessly integrate custom functions to perform tasks such as third party integrations, hitting end-points on a server, processing specific documents, and much more. These functions not only streamline the user experience but also provide you with invaluable insights and increased efficiency. We are excited to bring you this cutting-edge technology and invite you to explore the endless possibilities it offers."><meta data-react-helmet="true" property="og:description" content="Introducing our state-of-the-art bot builder platform, designed to empower you with the capabilities of natural language processing (NLP) and enhance your conversational AI solutions. As part of our commitment to delivering a truly tailored experience, we are delighted to offer a range of custom functions (some preset/predefined, some customizable) that will revolutionize the way your bots interact with your end users and/or customer. Custom functions enable you to create personalized and dynamic conversational flows, allowing your bots to understand user intents, extract key information, and generate intelligent responses. With our platform, you can effortlessly integrate custom functions to perform tasks such as third party integrations, hitting end-points on a server, processing specific documents, and much more. These functions not only streamline the user experience but also provide you with invaluable insights and increased efficiency. We are excited to bring you this cutting-edge technology and invite you to explore the endless possibilities it offers."><link data-react-helmet="true" rel="shortcut icon" href="/img/logo.svg"><link data-react-helmet="true" rel="canonical" href="https://docs.botlhale.xyz/docs/Platform/bot-builder/Custom Functions"><link data-react-helmet="true" rel="alternate" href="https://docs.botlhale.xyz/docs/Platform/bot-builder/Custom Functions" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.botlhale.xyz/docs/Platform/bot-builder/Custom Functions" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.f02c96dd.css">
<link rel="preload" href="/assets/js/runtime~main.2e88a6bc.js" as="script">
<link rel="preload" href="/assets/js/main.2d056aab.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Botlhale AI Logo" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/img/logo.svg" alt="Botlhale AI Logo" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><b class="navbar__title">Botlhale AI Documentation</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/Platform/bot-builder/Bot Creation">Platform</a><a class="navbar__item navbar__link navbar__link--active" href="/docs/APIs/Quickstart">APIs</a><a class="navbar__item navbar__link navbar__link--active" href="/docs/Tutorials/Platform Tutorials">Tutorials</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/blog">Blog</a><a href="https://github.com/Botlhale-AI" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_2i4l react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_iYfV">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button class="clean-btn backToTopButton_i9tI" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh menuWithAnnouncementBar_+O1J"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Platform</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Bot Builder</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Platform/bot-builder/Bot Creation">Bot Creation</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Platform/bot-builder/Intents">Intents</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Platform/bot-builder/Entities">Entities</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Platform/bot-builder/Dialogue Manager">Dialogue Manager</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Platform/bot-builder/Dialogue Elements">Dialogue Elements</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Platform/bot-builder/Custom Functions">Custom Functions</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Platform/bot-builder/Training">Train</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Platform/bot-builder/Testing">Test</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Live Bots</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Help Desk</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Settings</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">APIs</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Tutorials</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/docs/FAQs">Frequently Asked Questions</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Custom Functions</h1></header><p>Introducing our state-of-the-art bot builder platform, designed to empower you with the capabilities of natural language processing (NLP) and enhance your conversational AI solutions. As part of our commitment to delivering a truly tailored experience, we are delighted to offer a range of custom functions (some preset/predefined, some customizable) that will revolutionize the way your bots interact with your end users and/or customer. Custom functions enable you to create personalized and dynamic conversational flows, allowing your bots to understand user intents, extract key information, and generate intelligent responses. With our platform, you can effortlessly integrate custom functions to perform tasks such as third party integrations, hitting end-points on a server, processing specific documents, and much more. These functions not only streamline the user experience but also provide you with invaluable insights and increased efficiency. We are excited to bring you this cutting-edge technology and invite you to explore the endless possibilities it offers.</p><p><img src="https://botlhale-ai-assets.s3.amazonaws.com/doc-imgs/actions-dashboard.png" alt="actions dasboard">
<img src="https://botlhale-ai-assets.s3.amazonaws.com/doc-imgs/actions-dashboard-error.png" alt="actions dasboard error">
<img src="https://botlhale-ai-assets.s3.amazonaws.com/doc-imgs/actions-dashboard-success.png" alt="actions dasboard success"></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">class ResetAllSlots(Action):</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    def name(self) -&gt; Text:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return &quot;action_reset_all_form_items_preset&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    def run(self, dispatcher: CollectingDispatcher,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            tracker: Tracker,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            domain: Dict[Text, Any]) -&gt; List[Dict[Text, Any]]:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return [AllSlotsReset()]</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">#beginhandlingfiles</span></span><span class="token-line" style="color:#393A34"><span class="token plain">class ActionHandleImage(Action):</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    def name(self) -&gt; Text:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return &quot;action_handle_image&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    async def run(self, dispatcher: CollectingDispatcher, tracker: Tracker, domain: Dict[Text, Any],) -&gt; List[EventType]:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      # intent= tracker.latest_message[â€˜intentâ€™].get(â€˜nameâ€™)</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      img_url = tracker.latest_message[&#x27;text&#x27;][22:-2]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      url = &quot;https://hmsa.zendesk.com/api/v2/tickets?API_TOKEN=kfz5uygbXuUY1BArFuvz5RmLekQ04A5S9pTnL6fW&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span></span><span class="token-line" style="color:#393A34"><span class="token plain">      payload = json.dumps(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;ticket&quot;: </span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &quot;subject&quot;: &quot;WhatsApp Chatbot - Stock Request (Image Attached)&quot;, </span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &quot;comment&quot;: {&quot;body&quot;: &quot;Stock Request with Image Attached&quot;},</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &quot;priority&quot;: &quot;high&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &quot;tags&quot;: &quot;tag&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &quot;type&quot;: &quot;task&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &quot;email_ccs&quot;: [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        # { &quot;user_id&quot;: &quot;562624&quot;, &quot;action&quot;: &quot;put&quot; },</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        { &quot;user_email&quot;: &quot;athi@botlhale.ai&quot;, &quot;user_name&quot;: &quot;Additional Email&quot;, &quot;action&quot;: &quot;put&quot;},</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        { &quot;user_email&quot;: &quot;claudia.southgate@hm.com&quot;, &quot;user_name&quot;: &quot;H&amp;M Team Member&quot;, &quot;action&quot;: &quot;put&quot;}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                      ],</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                      &quot;comment&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &quot;body&quot;: f&quot;Please find the attached image.\nClick here to download image: {img_url}&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                      },</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                      &quot;tags&quot;: [&quot;image&quot;],</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                      &quot;uploads&quot;: [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                          {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                              &quot;filename&quot;: &quot;image_path&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                              &quot;content_type&quot;: &quot;image/jpeg&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                              &quot;data&quot;: &quot;image_data&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                          }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            ]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      headers = {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  &#x27;Content-Type&#x27;: &#x27;application/json&#x27;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  &#x27;Authorization&#x27;: &#x27;Basic YXRoaUBib3RsaGFsZS5haTojR3VkZGFiYjExMQ==&#x27;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  &#x27;Cookie&#x27;: &#x27;__cfruid=8aec605012b96541fd8498f62e68685556054667-1685959857; __cfruid=1a5e38ce20f7b8c45d5d9cf52fb3e86cc65e7dbc-1686037392; _zendesk_cookie=BAhJIhl7ImRldmljZV90b2tlbnMiOnt9fQY6BkVU--459ed01949a36415c1716b5711271c3d08918307&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      response = requests.request(&quot;POST&quot;, url, headers=headers, data=payload)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span></span><span class="token-line" style="color:#393A34"><span class="token plain">      from rasa_sdk.events import ActionExecuted, UserUttered</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span></span><span class="token-line" style="color:#393A34"><span class="token plain">      data = {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                  &quot;intent&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                      &quot;name&quot;: &quot;after_image_upload&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                      &quot;confidence&quot;: 1.0,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      return [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                  ActionExecuted(&quot;action_listen&quot;),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                  UserUttered(text=&quot;/after_image_upload&quot;, parse_data=data),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            ]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    # dispatcher.utter_message(text = str(tracker.latest_message))</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span></span><span class="token-line" style="color:#393A34"><span class="token plain">class ActionHandlePDF(Action):</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    def name(self) -&gt; Text:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return &quot;action_handle_pdf&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    async def run(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            self,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            dispatcher: CollectingDispatcher,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            tracker: Tracker,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            domain: Dict[Text, Any],</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        ) -&gt; List[EventType]:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            dispatcher.utter_message(text=&quot;Hi, unfortunately, I do not process pdf files.&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            #dispatcher.utter_message(text=str(tracker.latest_message))</span></span><span class="token-line" style="color:#393A34"><span class="token plain">#endhandlingfiles</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span></span><span class="token-line" style="color:#393A34"><span class="token plain">class ActionGreet(Action):</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    def name(self) -&gt; Text:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return &quot;action_greet&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    def run(self, dispatcher: CollectingDispatcher,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            tracker: Tracker,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            domain: Dict[Text, Any]) -&gt; List[Dict[Text, Any]]:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        print(&#x27;action_greet...&#x27;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        # get user number</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        sessionID_payload = {&quot;sender_id&quot;:tracker.sender_id}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        check_contact_payload = {&quot;sender_id&quot;:tracker.sender_id}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        platform = &#x27;whatsapp&#x27; #requests.post(&#x27;https://app.botlhale.xyz/check_platform&#x27;, platform_payload).content.decode(&#x27;utf-8&#x27;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        actual_contact = requests.post(&#x27;https://whatsapp.botlhale.xyz/getuserid&#x27;, sessionID_payload).content.decode(&#x27;utf-8&#x27;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        whatsapp_user_name = requests.post(&#x27;https://whatsapp.botlhale.xyz/getusername&#x27;, {&quot;number&quot;: actual_contact}).content.decode(&#x27;utf-8&#x27;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        verification_url = &quot;https://app-dev.botlhale.xyz/hm/verify_user/&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        verification_response = None</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        verification_body   = {&#x27;number&#x27;: actual_contact, &#x27;task&#x27;:&quot;verify_user&quot;}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        params = {}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        header = {}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        verification_response = requests.post(verification_url, verification_body, header)</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        if verification_response.json()[&#x27;status&#x27;]==False: # user greeting for the first time</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            print(&quot;present terms&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            message_to_customer = &quot;Hello, *&quot; + whatsapp_user_name + &quot;*!\n\nWelcome to H&amp;M South Africa. My name is *Hennes*, I am a CHATBOT, and I am here to assist you. You can interact with me through text or through speech (voice notes).\n\n Send *Hi* to go back to the main menu.&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span></span><span class="token-line" style="color:#393A34"><span class="token plain">            buttons = [{&quot;title&quot;:&quot;View Terms&quot;, &quot;payload&quot;:&quot;/view_terms&quot;}, {&quot;title&quot;:&quot;Accept Terms&quot;, &quot;payload&quot;:&quot;/accept_terms&quot;}, {&quot;title&quot;:&quot;Decline Terms&quot;, &quot;payload&quot;:&quot;/decline_terms&quot;}]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            dispatcher.utter_message(text=message_to_customer, buttons=buttons)</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        else:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          print(&quot;hey, great to have you back!&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          message_to_customer = &quot;Hello, *&quot; + whatsapp_user_name + &quot;*!\n\nWelcome to H&amp;M South Africa. My name is *Hennes*, I am a CHATBOT, and I am here to assist you. You can interact with me through text or through speech (voice notes).&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          buttons = [{&quot;title&quot;:&quot;Main Menu&quot;, &quot;payload&quot;:&quot;/main_menu&quot;}]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          dispatcher.utter_message(text=message_to_customer, buttons=buttons)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return []</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span></span><span class="token-line" style="color:#393A34"><span class="token plain">class ActionCheckTradingHours(Action):</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    def name(self) -&gt; Text:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return &quot;action_check_trading_hours&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    def run(self, dispatcher: CollectingDispatcher,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            tracker: Tracker,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            domain: Dict[Text, Any]) -&gt; List[Dict[Text, Any]]:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        print(&#x27;action_check_trading_hours...&#x27;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        store_city = tracker.slots.get(&#x27;choose_city&#x27;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        store_city = store_city.replace(&#x27;/&#x27;,&#x27;&#x27;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        store_city = store_city.replace(&#x27; &#x27;,&#x27;-&#x27;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        store_city = store_city.lower()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        #store_city = store_city.replace(&#x27; &#x27;, &#x27;&#x27;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        store_name = tracker.slots.get(&#x27;choose_store&#x27;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        store_name = store_name.replace(&#x27;/&#x27;,&#x27;&#x27;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        # store-locator config-info</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        url = f&quot;https://www.hm.com/za/store-locator/south-africa/{store_city}/{store_name}&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        payload = {}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        headers = {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;Cookie&#x27;: &#x27;HMCORP_locale=en_US; HMCORP_locale_autoassigned=true; HMCOUNTRY_name=United States; _abck=24FDDFA18261EA7F279DC8286F2C5E31~-1~YAAQIWdNaMJs3ayFAQAAGHLsvgkcCtRhj5bvX78LPzYs8hpwYnE5Pm9B6F14LRS4g1QlX4asMUvYlFcbNMdfM2QMR7o2xifflgHIMyx3EOFOp1NU8R4HrmWvuXZAESeZZVE304pnW8Bh0ferQmbydSmjd6aqLvG3ciNczIG8LOrIn00ZI6GB5FGVDi4u8eP0DWm2Cg1z0pI6qDD9kTQ7pIrLu+qg2KzzJGg415HD2yj6aNnlDFbPLNf9af1yy0uExGqBA2kfC5e1CPW3kf0j+W0GaNl6OR5OiP0cOHnrvBHz3RRsythLaoRgyXrXsn2wZ+Oih5B6RY052p5ddtLpaiXq3e7zU5DMlJ9NY7sm6sqGWZH0yA==~-1~-1~-1; ak_bmsc=336981498807787967D6E9BF57DEAE90~000000000000000000000000000000~YAAQb+4uF8KAzKuFAQAAdp32vhJNegEQkxZSBRgvCo8rUB/0J5Pbu3YFF1KdI/srI248AaCCB3/p1Cn/bzE8Lup54U5aoMtkdlgw1rIQhF3ARvQPLvl24mzn/0ILdA7pMZYhW15tmEUPMTqzbvv6bZxqA1Lxop++fnohClzHNVlnRYis9iWaMw1yDe1kf/ZHaiTVeDhC8XEkREf/KXXbeeUuJsxb8+xooDTuiZZV0YAwLgGcCKhgffsX0yHEG2XZh/Aa91z2+dDt56LNacl1yPrTs/xZspLVJKefVrAdBJBNJ8ViE1liPxEy158cKN2DPIXsNIxhXIDu51UxwwrPnFaOa3YgfODb9lJmghRcsYeyjMIkQCcr; bm_mi=1D4D588B115D81B87057848EE055EC27~YAAQb+4uF3+RzKuFAQAAgQX5vhKTUceN6sF9zjhU+Vmy6rEHJtY8TrXsj2owpbzz/snXr5ZWneiRmXthJrZgyXAeDuRdko/Reb9N9cAP1kESCEHFuSaVXR4+DnQHXJv0OO0yn//CQylmwE2njbIJHQj3EkT820a6jBTzSA7+xVI7PAEJcK56Gtr0QvbF6f60lVIjzoQ8dyFhHWr0eNj6/w2YxQSXy57xQ1/5cm45UKK9nEbaHACaepEbS5GGCZkIovghNqE0des8K237lQ1cnBD/S1+FAWZauGrys/ou5M0lmNvk4plaogIYMNKe+cYx5B3RcB+hlNFkeCIHV+JK+tXVVH3OUAXPZrZmXN1HZAqD+kaEbOSviSP8G0GrWBFvndHP71etScowqQ==~1; bm_sv=1CCF0C9ED9BFDA47B0EC4CCC2FE5A7AC~YAAQb+4uF4CRzKuFAQAAgQX5vhL+wi8xCOdhODrv4EqkqwrY+cZqmIo2PLF+7JpIcDDtQHZdRB4wsx/UWoK2gxHQrS81I3zkq3mAZ3ufEP3n8HtYoojvPAb5BwkZLYbFPav0Yxd3TSfP8fYlHG3LyelqfZjFAscw4SvgKqq/xYJC6d/Q6d6DHSa1eRJiDGV0vQgZ5dD/kQuvnClXUUMAXgL4godk1ktefjMHwbzS0eYxnCu9jWv1feQi1mU=~1; bm_sz=EE895B8175ADDB8843F0BEBED664882A~YAAQIWdNaMNs3ayFAQAAGHLsvhIn0PTphS6AnOT7UK7BZRidurEpyGhlAD1sbInkbFKcdBH01sgaOTCKaNGUqqBhuARBkx4Rs5Wz2+2HNLcCKL+3vUJNQsE7dI6vdws0ONwa+vpYgr07hokSJKDzj2+RldWRSvDarcB6agONnvtbeYU8Ie+Ls/VEe3kSEL7YOHq9ywnAo/kSFm89TxXSQmspq8un6bVnctXrHkUdYJCR64EWeeKvwMn5xPNcfjrYE+AGDBSoVpjmQb56UBlw5CmyaeSNpQr9JgJzTfHdwA==~3228211~3224120; ARRAffinity=6bd50489cc791ea1ae55225c0ec2598308fd3113beeb7ca4800977de19a680d6; ARRAffinitySameSite=6bd50489cc791ea1ae55225c0ec2598308fd3113beeb7ca4800977de19a680d6; VtexWorkspace=master%3A-; akavpau_www2_en_us=1673946552~id=7c8b8c623438ae5211577c96d77f9673; qtrans_front_language=za&#x27;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;Host&#x27;: &#x27;www.hm.com&#x27;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;User-Agent&#x27;: &#x27;Chrome v22.2 Linux Ubuntu&#x27;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;Accept&#x27;: &#x27;*/*&#x27;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;Accept-Encoding&#x27;: &#x27;gzip, deflate, br&#x27;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;Connection&#x27;: &#x27;keep-alive&#x27;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;X-Requested-With&#x27;: &#x27;XMLHttpRequest&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        #buttons = [{&quot;title&quot;: &quot;Back to Menu&quot;,&quot;payload&quot;: &#x27;/main_menu&#x27;,}]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        buttons = [{&quot;payload&quot;: &quot;/main_menu&quot;, &quot;title&quot;: &quot;Back to Menu&quot;},]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        message_to_user = &quot;&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        try:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          response = requests.request(&quot;GET&quot;, url, headers=headers, data=payload)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span></span><span class="token-line" style="color:#393A34"><span class="token plain">          html_doc = response.content</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          html_content = BeautifulSoup(html_doc, &#x27;html.parser&#x27;) # parse html response as readable info</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          soup_table = html_content.table # extract table from html response into a dictionary</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span></span><span class="token-line" style="color:#393A34"><span class="token plain">          opening_hours = {}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          day  = &quot;&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          times = &quot;&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span></span><span class="token-line" style="color:#393A34"><span class="token plain">          for row in soup_table.findAll(&#x27;tr&#x27;):</span></span><span class="token-line" style="color:#393A34"><span class="token plain">              print(&quot;ROW&quot;,row)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">              aux = row.findAll(&#x27;td&#x27;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">              day = aux[0].string</span></span><span class="token-line" style="color:#393A34"><span class="token plain">              opening_hours[day] = aux[1].text</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          dispatcher.utter_message(text=f&quot;*{store_name.upper()} ({store_city.upper()}) TRADING HOURS*&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span></span><span class="token-line" style="color:#393A34"><span class="token plain">          for item in opening_hours:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            message_to_user = str(item)+&quot; : &quot;+str(opening_hours[item])</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            dispatcher.utter_message(text=message_to_user)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          dispatcher.utter_message(text=f&quot;\n_More info about {store_name.upper()} on Store Locator: &quot;+str(url)+&quot;_&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        except:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          result = False</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          message_to_user = f&quot;Something went wrong with retrieving the trading hours of the {store_name} store, please try again by *selecting one of the listed options under stores*.&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          dispatcher.utter_message(text=message_to_user, buttons = buttons)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        finally:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          dispatcher.utter_message(text=&quot;&quot;, buttons = buttons)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return [] </span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span></span><span class="token-line" style="color:#393A34"><span class="token plain">class ActionViewTerms(Action):</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    def name(self) -&gt; Text:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return &quot;action_view_terms&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    def run(self, dispatcher: CollectingDispatcher,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            tracker: Tracker,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            domain: Dict[Text, Any]) -&gt; List[Dict[Text, Any]]:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        print(&#x27;action_view_terms...&#x27;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        try:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            payload = {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                  &#x27;type&#x27;: &#x27;document&#x27;, # document/image/video</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                  &#x27;link&#x27;: &#x27;https://botlhale-ai-assets.s3.amazonaws.com/hm_terms.pdf&#x27;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                  &#x27;caption&#x27;: &#x27;Terms&#x27;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                  &#x27;filename&#x27;: &#x27;Terms.pdf&#x27; # only include when type == document</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            # accept or decline terms</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            buttons = [{&quot;title&quot;: &quot;Accept&quot;, &quot;payload&quot;: &quot;accept_terms&quot;}, </span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        {&quot;title&quot;: &quot;Decline&quot;, &quot;payload&quot;: &quot;decline_terms&quot;}]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            dispatcher.utter_message(text=&quot;Please find the terms and conditions attached or you can view them on https://www.hm.com/za/ &quot;,json_message=payload, buttons=buttons)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        except:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          response = &#x27;Something went wrong, please type *hi* to resume.&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          dispatcher.utter_message(text=response)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return []</span></span><span class="token-line" style="color:#393A34"><span class="token plain"># action for store_names below</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">class AskForSlotAction(Action):</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    def name(self) -&gt; Text:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return &quot;action_ask_choose_store&quot; # confirm the name here on domain.yml responses</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    def run(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        self, dispatcher: CollectingDispatcher, tracker: Tracker, domain: Dict</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ) -&gt; List[EventType]:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        store_city = tracker.slots.get(&#x27;choose_city&#x27;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        store_city = store_city.replace(&#x27;/&#x27;,&#x27;&#x27;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        print(&quot;STORE_CITY VALUE: &quot;, store_city)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        #dispatcher.utter_message(text=&quot;inside slot action: city : &quot;+store_city)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        buttons = {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;Bloemfontein&quot;: [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            {&quot;payload&quot;: &quot;loch-logan-waterfront&quot;, &quot;title&quot;: &quot;Loch Logan Waterfront&quot;}, </span></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        ],</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;Cape Town&quot;: [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            {&quot;payload&quot;: &quot;canal-walk-shopping-centre&quot;, &quot;title&quot;: &quot;Canal Walk Shopping Centre&quot;}, </span></span><span class="token-line" style="color:#393A34"><span class="token plain">            {&quot;payload&quot;: &quot;cavendish-square&quot;,&quot;title&quot;: &quot;Cavendish Square&quot;},</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            {&quot;payload&quot;: &quot;eikestad-mall&quot;, &quot;title&quot;: &quot;Eikestad Mall&quot;}, </span></span><span class="token-line" style="color:#393A34"><span class="token plain">            {&quot;payload&quot;: &quot;somerset-mall&quot;, &quot;title&quot;: &quot;Somerset Mall&quot;}, </span></span><span class="token-line" style="color:#393A34"><span class="token plain">            {&quot;payload&quot;: &quot;table-bay-mall&quot;, &quot;title&quot;: &quot;Table Bay Mall&quot;}, </span></span><span class="token-line" style="color:#393A34"><span class="token plain">            {&quot;payload&quot;: &quot;victoria-alfred-waterfront&quot;, &quot;title&quot;: &quot;Victoria &amp; Alfred Waterfront&quot;}, </span></span><span class="token-line" style="color:#393A34"><span class="token plain">            {&quot;payload&quot;: &quot;tygervalley-shopping-center&quot;, &quot;title&quot;: &quot;Tygervalley Shopping Center&quot;},   </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        ],</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;Durban&quot;: [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            {&quot;payload&quot;: &quot;gateway-theatre-of-shopping&quot;, &quot;title&quot;: &quot;Gateway Theatre of Shopping&quot;},</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            {&quot;payload&quot;: &quot;the-pavilion&quot;, &quot;title&quot;: &quot;The Pavilion&quot;},</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            {&quot;payload&quot;: &quot;ballito-junction&quot;, &quot;title&quot;: &quot;Ballito Junction&quot;},</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            {&quot;payload&quot;: &quot;ballito-junction-kids&quot;, &quot;title&quot;: &quot;Ballito Junction Kids&quot;},</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        ],</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;East London&quot;: [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            {&quot;payload&quot;: &quot;vincent-park&quot;, &quot;title&quot;: &quot;Vincent Park&quot;}, </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        ],</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;Johannesburg&quot;: [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            {&quot;payload&quot;: &quot;clearwater-mall&quot;, &quot;title&quot;: &quot;Clearwater Mall&quot;}, </span></span><span class="token-line" style="color:#393A34"><span class="token plain">            {&quot;payload&quot;: &quot;cresta-shopping-centre&quot;, &quot;title&quot;: &quot;Cresta Shopping Centre&quot;},</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            {&quot;payload&quot;: &quot;east-rand-mall&quot;, &quot;title&quot;: &quot;East Rand Mall&quot;},</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            {&quot;payload&quot;: &quot;eastgate-shopping-centre&quot;, &quot;title&quot;: &quot;Eastgate Shopping Centre&quot;},</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            {&quot;payload&quot;: &quot;fourways-mall&quot;, &quot;title&quot;: &quot;Fourways Mall&quot;},</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            {&quot;payload&quot;: &quot;mall-of-africa&quot;, &quot;title&quot;: &quot;Mall of Africa&quot;},</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            {&quot;payload&quot;: &quot;mall-of-the-south&quot;, &quot;title&quot;: &quot;Mall of the South&quot;},</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            {&quot;payload&quot;: &quot;rosebank-mall&quot;, &quot;title&quot;: &quot;Rosebank Mall&quot;},</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            {&quot;payload&quot;: &quot;sandton-city&quot;, &quot;title&quot;: &quot;Sandton City&quot;},</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            {&quot;payload&quot;: &quot;westgate-shopping-centre&quot;, &quot;title&quot;: &quot;Westgate Shopping Centre&quot;}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        ],</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;Nelspruit&quot;: [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            {&quot;payload&quot;: &quot;ilanga-mall&quot;, &quot;title&quot;: &quot;Ilanga Mall&quot;}, </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        ],</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;Polokwane&quot;: [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            {&quot;payload&quot;: &quot;mall-of-the-north&quot;, &quot;title&quot;: &quot;Mall of the North&quot;}, </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        ],</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;Port Elizabeth&quot;: [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            {&quot;payload&quot;: &quot;walmer-park&quot;, &quot;title&quot;: &quot;Walmer Park&quot;}, </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        ],</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;Pretoria&quot;: [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            {&quot;payload&quot;: &quot;centurion-mall&quot;, &quot;title&quot;: &quot;Centurion Mall&quot;},</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            {&quot;payload&quot;: &quot;menyln-park&quot;, &quot;title&quot;: &quot;Menyln Park&quot;},</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        ],</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;Richards Bay&quot;: [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            {&quot;payload&quot;: &quot;boardwalk-mall&quot;, &quot;title&quot;: &quot;Boardwalk Mall&quot;},</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        ],</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;Witbank&quot;: [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            {&quot;payload&quot;: &quot;highveld-mall&quot;, &quot;title&quot;: &quot;Highveld Mall&quot;},</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        ],</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;&#x27;&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        if store_city == &quot;Other&quot;:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            dispatcher.utter_message(text=&quot;Please tell us what province/district you live in.&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        else:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            print(buttons[store_city])</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            dispatcher.utter_message(text=&quot;Please select your store_city.&quot;, buttons=buttons[store_city])</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;&#x27;&#x27; </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        print(buttons[store_city])</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        dispatcher.utter_message(text=&quot;Select the name of the *store*:&quot;, buttons=buttons[store_city])</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return []</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span></span><span class="token-line" style="color:#393A34"><span class="token plain">class ActionSendFeedbackToZendesk(Action):</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    def name(self) -&gt; Text:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return &quot;action_send_feedback_to_zendesk&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    def run(self, dispatcher: CollectingDispatcher,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            tracker: Tracker,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            domain: Dict[Text, Any]) -&gt; List[Dict[Text, Any]]:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        print(&#x27;action_send_feedback_to_zendesk...&#x27;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        customer_name = tracker.slots.get(&quot;customer_name&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        customer_email = tracker.slots.get(&quot;customer_email&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        customer_feedback_category = tracker.slots.get(&quot;category&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        customer_feedback_category = customer_feedback_category.replace(&#x27; &#x27;, &#x27;-&#x27;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        customer_feedback = tracker.slots.get(&quot;actual_feedback&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        message_to_user = &quot;Thank you, &quot;+customer_name+&quot;! \nWe have received your feedback. We will follow up accordingly.&quot;    </span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        url = &quot;https://hmsa.zendesk.com/api/v2/tickets?API_TOKEN=kfz5uygbXuUY1BArFuvz5RmLekQ04A5S9pTnL6fW&quot; #7e5ohEU5g1jjzNE6kezgRBkGqyoKPkRZDTOsztTU</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        payload = json.dumps(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;ticket&quot;: </span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &quot;subject&quot;: &quot;WhatsApp Chatbot - Customer Feedback: &quot;+str(customer_feedback_category), </span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &quot;comment&quot;: {&quot;body&quot;: customer_feedback},</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &quot;priority&quot;: &quot;high&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &quot;tags&quot;: customer_feedback_category,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &quot;type&quot;: &quot;task&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &quot;email_ccs&quot;: [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        # { &quot;user_id&quot;: &quot;562624&quot;, &quot;action&quot;: &quot;put&quot; },</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        { &quot;user_email&quot;: &quot;athi@botlhale.ai&quot;, &quot;user_name&quot;: &quot;Additional Email&quot;, &quot;action&quot;: &quot;put&quot;},</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        { &quot;user_email&quot;: &quot;claudia.southgate@hm.com &quot;, &quot;user_name&quot;: &quot;H&amp;M Team Member&quot;, &quot;action&quot;: &quot;put&quot;}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                      ]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        headers = {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  &#x27;Content-Type&#x27;: &#x27;application/json&#x27;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  &#x27;Authorization&#x27;: &#x27;Basic YXRoaUBib3RsaGFsZS5haTojR3VkZGFiYjExMQ==&#x27;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  &#x27;Cookie&#x27;: &#x27;__cfruid=8aec605012b96541fd8498f62e68685556054667-1685959857; __cfruid=1a5e38ce20f7b8c45d5d9cf52fb3e86cc65e7dbc-1686037392; _zendesk_cookie=BAhJIhl7ImRldmljZV90b2tlbnMiOnt9fQY6BkVU--459ed01949a36415c1716b5711271c3d08918307&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        response = requests.request(&quot;POST&quot;, url, headers=headers, data=payload)</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        print(response.text)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        dispatcher.utter_message(text=message_to_user)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return []</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span></span><span class="token-line" style="color:#393A34"><span class="token plain">class ActionViewProductNumber(Action):</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    def name(self) -&gt; Text:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return &quot;action_view_product_number&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    def run(self, dispatcher: CollectingDispatcher,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            tracker: Tracker,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            domain: Dict[Text, Any]) -&gt; List[Dict[Text, Any]]:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        print(&#x27;action_view_product_number...&#x27;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        payload = {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                  &#x27;type&#x27;: &#x27;image&#x27;, # document/image/video</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                  &#x27;link&#x27;: &#x27;https://botlhale-ai-assets.s3.amazonaws.com/product_number.jpeg&#x27;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                  &#x27;caption&#x27;: &#x27;&#x27;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                  &#x27;filename&#x27;: &#x27;ProductNumber.pdf&#x27; # only include when type == document</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        dispatcher.utter_message(text=&quot;*PRODUCT NUMBER EXAMPLE:*&quot;,json_message=payload)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return []</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">class ActionTriggerLiveAgent(Action):</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    def name(self) -&gt; Text:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return &quot;action_trigger_live_agent&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    def run(self, dispatcher: CollectingDispatcher,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            tracker: Tracker,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            domain: Dict[Text, Any]) -&gt; List[Dict[Text, Any]]:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        print(&#x27;action_trigger_live_agent...&#x27;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        from rasa_sdk.events import ActionExecuted, UserUttered</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        data = {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                  &quot;intent&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                      &quot;name&quot;: &quot;human_handoff&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                      &quot;confidence&quot;: 1.0,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    ActionExecuted(&quot;action_listen&quot;),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    UserUttered(text=&quot;/human_handoff&quot;, parse_data=data),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">              ]</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span></span><span class="token-line" style="color:#393A34"><span class="token plain">class ActionVerifyTerms(Action):</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    def name(self) -&gt; Text:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return &quot;action_verify_terms&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    def run(self, dispatcher: CollectingDispatcher,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            tracker: Tracker,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            domain: Dict[Text, Any]) -&gt; List[Dict[Text, Any]]:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        print(&#x27;action_verify_terms...&#x27;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        # get user number</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        sessionID_payload = {&quot;sender_id&quot;:tracker.sender_id}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        check_contact_payload = {&quot;sender_id&quot;:tracker.sender_id}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        platform = &#x27;whatsapp&#x27; #requests.post(&#x27;https://app.botlhale.xyz/check_platform&#x27;, platform_payload).content.decode(&#x27;utf-8&#x27;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        actual_contact = requests.post(&#x27;https://whatsapp.botlhale.xyz/getuserid&#x27;, sessionID_payload).content.decode(&#x27;utf-8&#x27;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        whatsapp_user_name = requests.post(&#x27;https://whatsapp.botlhale.xyz/getusername&#x27;, {&quot;number&quot;: actual_contact}).content.decode(&#x27;utf-8&#x27;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        verification_url = &quot;https://app-dev.botlhale.xyz/hm/verify_user/&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        verification_response = None</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        verification_body   = {&#x27;number&#x27;: actual_contact, &#x27;task&#x27;:&quot;add_user&quot;}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        params = {}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        header = {}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        verification_response = requests.post(verification_url, verification_body, header)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return []</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span></span><span class="token-line" style="color:#393A34"><span class="token plain">class ActionSendFeedbackToGsheets(Action):</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    def name(self) -&gt; Text:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return &quot;action_send_feedback_to_gsheets&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    def run(self, dispatcher: CollectingDispatcher,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            tracker: Tracker,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            domain: Dict[Text, Any]) -&gt; List[Dict[Text, Any]]:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        print(&#x27;action_send_feedback_to_gsheets...&#x27;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        # get user number</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        platform_payload = {&quot;org&quot;:&quot;HM&quot;, &quot;session_id&quot;:tracker.sender_id}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        check_contact_payload = {&quot;sender_id&quot;:tracker.sender_id}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        platform = &#x27;whatsapp&#x27;#requests.post(&#x27;https://app.botlhale.xyz/check_platform&#x27;, platform_payload).content.decode(&#x27;utf-8&#x27;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        actual_contact = requests.post(&#x27;https://&#x27;+platform+&#x27;.botlhale.xyz/getuserid&#x27;, check_contact_payload).content.decode(&#x27;utf-8&#x27;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        response = requests.post(&#x27;https://app-dev.botlhale.xyz/save_hm_survey_data&#x27;, { &quot;number&quot;: actual_contact, &quot;score&quot;: tracker.slots.get(&quot;service_score&quot;), &quot;feedback&quot;: tracker.slots.get(&quot;feedback_for_the_agent&quot;)}).content.decode(&#x27;utf-8&#x27;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        from rasa_sdk.events import ActionExecuted, UserUttered</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        data = {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &quot;intent&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &quot;name&quot;: &quot;main_menu&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &quot;confidence&quot;: 1.0,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">              }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    ActionExecuted(&quot;action_listen&quot;),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    UserUttered(text=&quot;/main_menu&quot;, parse_data=data),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">              ] </span></span><span class="token-line" style="color:#393A34"><span class="token plain">#begin-handoff</span></span><span class="token-line" style="color:#393A34"><span class="token plain">class ValidateContactForm(FormValidationAction):</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    def name(self) -&gt; Text:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return &quot;validate_contact_form&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    def validate_name(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        self,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        slot_value: Text,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        dispatcher: CollectingDispatcher,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        tracker: Tracker,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        domain: DomainDict,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ) -&gt; List[EventType]:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        if slot_value.lower().islower():</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            return {&quot;name&quot;: slot_value}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        else:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            dispatcher.utter_message(text = &quot;I didn&#x27;t quite get that. Please provide a name.&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            return {&quot;name&quot;: None}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    def validate_email(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        self,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        slot_value: Text,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        dispatcher: CollectingDispatcher,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        tracker: Tracker,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        domain: DomainDict,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ) -&gt; List[EventType]:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        if slot_value.lower().islower():</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            return {&quot;email&quot;: slot_value}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        else:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            dispatcher.utter_message(text = &quot;I didn&#x27;t quite get that. Please use a valid email address.&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            return  {&quot;email&quot;: None}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">class ActionHandoffOptions(Action):</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    def name(self) -&gt; Text:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return &quot;action_handoff_options_preset&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    async def run(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        self,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        dispatcher: CollectingDispatcher,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        tracker: Tracker,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        domain: Dict[Text, Any],</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ) -&gt; List[EventType]:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        organisation = &quot;DemoOrganisation&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        departments = json.loads(requests.get(&#x27;https://app.botlhale.xyz/get_departments&#x27;,data=json.dumps({&#x27;org&#x27;:organisation})).content.decode(&#x27;utf-8&#x27;))[&#x27;departments&#x27;]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        handoff_department_options = []</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        for department in departments:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            button = {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &quot;title&quot;: department,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &quot;payload&quot;: &#x27;/trigger_handoff{&quot;department&quot;:&#x27;+f&#x27;&quot;{department}&quot;&#x27;+&#x27;}&#x27;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            handoff_department_options.append(button)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        buttons = handoff_department_options</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        dispatcher.utter_message(text=&#x27;What department would you like me to connect you to?&#x27;, buttons=buttons)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return []</span></span><span class="token-line" style="color:#393A34"><span class="token plain">class ActionHandoff(Action):</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    def name(self) -&gt; Text:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return &quot;action_handoff_preset&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    async def run(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        self,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        dispatcher: CollectingDispatcher,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        tracker: Tracker,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        domain: Dict[Text, Any],</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ) -&gt; List[EventType]:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        department = tracker.slots.get(&quot;department&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        dispatcher.utter_message(text=&quot;I have put you on the queue. You will be connected to the next available agent. To leave the queue, send &#x27;disconnect&#x27;.&quot;, json_message={&quot;department&quot;: department})</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return [SlotSet(&#x27;department&#x27;, None)]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">class ActionCheckContactList(Action):</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    def name(self) -&gt; Text:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return &quot;action_check_contact_list_preset&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    async def run(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        self,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        dispatcher: CollectingDispatcher,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        tracker: Tracker,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        domain: Dict[Text, Any],</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ) -&gt; List[EventType]:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        organisation = &quot;DemoOrganisation&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        platform = requests.post(&#x27;https://app.botlhale.xyz/check_platform&#x27;, {&quot;org&quot;:organisation, &quot;session_id&quot;:tracker.sender_id}).content.decode(&#x27;utf-8&#x27;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        actual_contact = requests.post(&#x27;https://&#x27;+platform+&#x27;.botlhale.xyz/getuserid&#x27;, {&quot;sender_id&quot;:tracker.sender_id}).content.decode(&#x27;utf-8&#x27;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        response = json.loads(requests.post(&#x27;https://app.botlhale.xyz/contact_list&#x27;, { &quot;task&quot;: &quot;check_from_actions&quot;, &quot;session_id&quot;: actual_contact, &quot;organisation&quot;: organisation}).content.decode(&#x27;utf-8&#x27;))</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        found    = response[&quot;found&quot;]</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        if not found:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            details = [FollowupAction(&#x27;contact_form&#x27;)]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            return details</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span></span><span class="token-line" style="color:#393A34"><span class="token plain">class SubmitContact(Action):</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    def name(self) -&gt; Text:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return &quot;action_submit_contact&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    async def run(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        self,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        dispatcher: CollectingDispatcher,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        tracker: Tracker,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        domain: Dict[Text, Any],</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ) -&gt; List[EventType]:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        organisation = &quot;DemoOrganisation&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        name = tracker.slots.get(&quot;name&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        email = tracker.slots.get(&quot;email&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        language = &quot;English&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        platform = requests.post(&#x27;https://app.botlhale.xyz/check_platform&#x27;, {&quot;org&quot;:organisation, &quot;session_id&quot;:tracker.sender_id}).content.decode(&#x27;utf-8&#x27;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        actual_contact = requests.post(&#x27;https://&#x27;+platform+&#x27;.botlhale.xyz/getuserid&#x27;, {&quot;sender_id&quot;:tracker.sender_id}).content.decode(&#x27;utf-8&#x27;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        response = requests.post(&#x27;https://app.botlhale.xyz/contact_list&#x27;, { &quot;task&quot;: &quot;create_from_actions&quot;, &quot;session_id&quot;: actual_contact, &quot;organisation&quot;: organisation, &quot;name&quot;:name, &quot;email&quot;:email, &quot;platform&quot;:platform, &quot;language&quot;:language}).content.decode(&#x27;utf-8&#x27;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return []</span></span><span class="token-line" style="color:#393A34"><span class="token plain">#end-handoff</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Human HandOff Integration to External Parties</h5></div><div class="admonition-content"></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="human-handoff-integration"></a>Human Handoff Integration<a class="hash-link" href="#human-handoff-integration" title="Direct link to heading">#</a></h2><p>The Botlhale NLP Toolkit has a predefined dialogue that can be selected to enable the human handoff feature. See the <a href="https://github.com/Botlhale-AI/documentation/blob/master/docs/0%20-%20Platform/bot-builder/3%20-%20Dialogue%20Manager.md#create-preset-dialogues" target="_blank" rel="noopener noreferrer">Dialogue Manager</a> section of this documentation for information on how to enable this preset dialogue.</p><p>The human handoff dialogue contains the following two dialogue streams: </p><ul><li>provide_handoff_options </li><li>execute_handoff </li></ul><p>These two dialogues work off the shell and do not require any modifications. </p><p>The human handoff capability uses <a href="https://socket.io/docs/v3/" target="_blank" rel="noopener noreferrer">Socket.IO</a>, a library that allows message passing between a server and multiple clients. All chatbots with human handoff set up need to connect to Botlhale AI&#x27;s <a href="https://app.botlhale.xyz/live_server" target="_blank" rel="noopener noreferrer">Socket.IO server</a></p><p>The following code snippets can be used to set up socket IO, as well as event listener and emitter functions to interface with Botlhale AI&#x27;s Socket.IO server. The code snippets use JavaScript. However, if your bot is integrated in a non-JavaScript environment, there are several client implementations available in other languages. See the <a href="https://socket.io/docs/v3/" target="_blank" rel="noopener noreferrer">Socket.IO documentation</a> for additional information.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">script src</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;https://cdn.socket.io/3.1.3/socket.io.min.js&quot;</span><span class="token plain"> </span></span><span class="token-line" style="color:#393A34"><span class="token plain">integrity</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;sha384-cPwlPLvBTa3sKAgddT6krw0cJat7egBga3DJepJyrLl4Q9/5WLra3rrnMcyTyOnh&quot;</span><span class="token plain"> crossorigin</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;anonymous&quot;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">script</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// SOCKET IO initialisation !</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> socket </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> io</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;https://app.botlhale.io/live_agent&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token literal-property property" style="color:#36acaa">autoConnect</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// first time connecting to the main socket !</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">socket</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;startConversation&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">   socket</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">emit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;username&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token string-property property" style="color:#36acaa">&quot;ConversationID&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">ConversationID</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token string-property property" style="color:#36acaa">&quot;BotID&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">BotID</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// receiving a message !</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">socket</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;to_user&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> text </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">message</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token function" style="color:#d73a49">setBotResponse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">text</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// send messages to clients !</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">socket</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;messages&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> messages </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// populate messages variable with user-bot conversation !</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// each element in the array must have the following format:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// {&#x27;sender&#x27;: String, &#x27;message&#x27;: String}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// if message belongs to the user, then the value of &#x27;sender&#x27; must be &#x27;user&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// if message belongs to the bot, then the value of &#x27;sender&#x27; must be &#x27;bot&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">   socket</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">emit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;messages_to_client&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token string-property property" style="color:#36acaa">&quot;messages&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> messages</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token string-property property" style="color:#36acaa">&quot;bot_id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">BotID</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// disconnecting socket !</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">socket</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;disconnect_socket&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">   socket</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">disconnect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Sending a message</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">socket</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">connected</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Send a message to socket </span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">   socket</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">emit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;from_user&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token string-property property" style="color:#36acaa">&quot;message&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> message</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token string-property property" style="color:#36acaa">&quot;ConversationID&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">ConversationID</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token string-property property" style="color:#36acaa">&quot;BotID&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">BotID</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Send a message bot</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><blockquote><p>We are here to help! Please email <a href="mailto:support@botlhale.ai" target="_blank" rel="noopener noreferrer">support@botlhale.ai</a> with any questions.</p></blockquote></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/Platform/bot-builder/Dialogue Elements"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Dialogue Elements</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/Platform/bot-builder/Training"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Train Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#human-handoff-integration" class="table-of-contents__link">Human Handoff Integration</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Platform Doc</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/Platform/bot-builder/Bot Creation">Bot Builder</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/Platform/live-bots/Deployments">Live Bots</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/Platform/help-desk/Live Chats">Help Desk</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/Platform/settings/General Settings">Settings</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/Platform/Tutorials/Platform Tutorials">Tutorials</a></li></ul></div><div class="col footer__col"><div class="footer__title">APIs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/APIs/Quickstart">Quickstart</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/APIs/Authentication">Authentication</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/APIs/Errors">Response Codes</a></li></ul></div><div class="col footer__col"><div class="footer__title">Speech APIs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/APIs/Rest APIs/Speech APIs/ASR">ASR</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/APIs/Rest APIs/Speech APIs/TTS">TTS</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://www.linkedin.com/company/18812768/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://facebook.com/botlhaleAI" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Facebook<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/botlhaleai" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://botlhale.ai/2021/07/13/9-reasons-your-business-needs-a-chatbot/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/botlhale-ai/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2023 Botlhale AI Pty Ltd, All rights reserved.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.2e88a6bc.js"></script>
<script src="/assets/js/main.2d056aab.js"></script>
</body>
</html>